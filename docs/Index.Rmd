---
title: "PM566 Midterm Project"
author: "Carmen Jiawen Chen"
date: "10/20/2021"
output: 
  github_document: default
  html_document:
    html_preview: false
  word_document: default
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(gtsummary)
library(kableExtra)
```
**Vaccination rates and COVID-19 cases and deaths in California**

**Introduction** (provide background on your dataset and formulated question)

Vaccination rate and COVID-19 incidence cases and deaths increase in California.


**Methods** (include how and where the data were acquired, how you cleaned and wrangled the data, what tools you used for data exploration)

Data of COVID-19 cases and vaccination rates were acquired from California Health & Human Services Agency and US Center for Disease Control and Prevention, respectively. Data 

```{r read in the data}
cases <- read.csv("Cases.csv")
vaccinations <- read.csv("Vaccinations.csv")
```

```{r data wrangling}
#subset the data
vaccinations <- vaccinations[vaccinations$Location == "CA",]
vaccinations <- vaccinations[, c("Date", "Administered_Dose1_Pop_Pct", "Series_Complete_Pop_Pct")] 
cases <- cases[cases$area == "California",]
cases <- cases[, c("date", "cases", "cumulative_cases", "deaths", "cumulative_deaths")]
#rename the data
vaccinations <- rename(vaccinations, date = Date, dose1 = Administered_Dose1_Pop_Pct, dose2 = Series_Complete_Pop_Pct)
#format date
vaccinations$date <- as.Date(vaccinations$date, format = "%m/%d/%Y")
cases$date <- as.Date(cases$date, format = "%Y-%m-%d")
```


Dimensions, headers, and footers of the two datasets were checked. There are 311 observations and 3 rows in the "vaccinations" dataset, as well as 628 observations and 5 rows in the "cases" dataset. Implausible data (e.g., 0 cases increase) was found in the date variable on "2021-10-20" in the "cases" dataset. Considering the 14-day incubation period of the COVID-19 disease, the data from 2021-10-06 to 2021-10-20 were not the final accurate number of cases and deaths since there are still many cases and deaths were not reported timely. Thus, these data were removed from the "cases" dataset. 

```{r data exploration, results='hide'}
#check the date
summary(vaccinations$date)
summary(cases$date)
#check for missing value
cases[!complete.cases(cases),]
vaccinations[!complete.cases(vaccinations),]
#remove rows with missing value
cases <- cases[complete.cases(cases),]
#check the dimensions, headers, footers
dim(vaccinations)
dim(cases)
head(vaccinations)
cases <- cases[order(cases$date, decreasing = TRUE),]
head(cases)
tail(vaccinations)
tail(cases)
#remove the data from 2021-10-06 to 2021-10-20
cases <- cases[!(cases$date >= "2021-10-06"),]
#take a look at the variables
str(vaccinations)
summary(vaccinations$dose1)
summary(vaccinations$dose2)
str(cases)
summary(cases$cases)
summary(cases$cumulative_cases)
summary(cases$deaths)
summary(cases$cumulative_deaths)
```


The two datasets were merged into one dataset by date. Final dataset has 296 observations (i.e. rows) and 7 variables (i.e., columns). Exploratory data analysis was conducted in the merged dataset. No missing value, implaussible vaule or data error was found. The data includes COVID-19 partial and fully vaccination rates, daily new cases, cumulative cases, daily new deaths, as well cumulative deaths from 2020/12/14 to 2021/10/05. Both univariate and bivariate summary statistics was analyzed. Exploratory graphs were generated between vaccination rates and cases and deaths.  


```{r combine the dataset, results='hide'}
#combine the dataset
covid <- merge(vaccinations, cases, by = "date")
#exploratory analysis
dim(covid)
head(covid)
tail(covid)
str(covid)
summary(covid$date)
summary(covid$dose1)
summary(covid$dose2)
summary(covid$cases)
summary(covid$cumulative_cases)
summary(covid$deaths)
summary(covid$cumulative_cases)
covid[!complete.cases(covid),]
```

**Preliminary Results** (provide summary statistics in tabular form and publication-quality figures, take a look at the kable function from knitr to write nice tables in Rmarkdown)

```{r table 1}
#Table 1. Characteristics of the COVID-19 data
covid %>%
  select("Date" = date,
         "First dose, %" = dose1,
         "Second dose, %" = dose2,
         "Daily new cases" = cases,
         "Cumulative cases" = cumulative_cases,
         "Daily new deaths" = deaths,
         "Cumulative deaths" = cumulative_deaths) %>%
  tbl_summary() %>%
  modify_caption ("**Table 1. Characteristics of the COVID-19 data**")
```

```{r table 2}
#First dose correlation
Cases = cor(covid$dose1, covid$cases, use = "complete")
Deaths = cor(covid$dose1, covid$deaths, use = "complete")
`First dose` = rbind(Cases, Deaths) 
colnames(`First dose`) <- "First dose"
#Second dose correlation
Cases = cor(covid$dose2, covid$cases, use = "complete")
Deaths = cor(covid$dose2, covid$deaths, use = "complete")
`Second dose` = rbind(Cases, Deaths) 
colnames(`Second dose`) <- "Second dose"
#Combine the table
cbind(`First dose`, `Second dose`) %>%
kable(caption = "<b>Table 2. Correlation coefficients of vacciantion rates and cases/deaths<b>")
```


```{r exploratory graphs}
#Vaccination rates
ggplot(data = covid) +
  geom_point(mapping = aes(x = date, y = dose1, color = "First dose")) +
  geom_point(mapping = aes(x = date, y = dose2, color = "Second dose")) +
  labs(title = "Figure 1. Vaccination rates from 2020-12-14 to 2021-10-05") +
  labs(x = "Date", y = "Vaccination rates")

#Cases
ggplot(data = covid) +
  geom_point(mapping = aes(x = date, y = cases)) +
  labs(title = "Figure 2a. Daily new cases from 2020-12-14 to 2021-10-05") +
  labs(x = "Date", y = "Daily new cases")

#Deaths
ggplot(data = covid) +
  geom_point(mapping = aes(x = date, y = deaths)) +
  labs(title = "Figure 2b. Daily new deaths from 2020-12-14 to 2021-10-05") +
  labs(x = "Date", y = "Daily new deaths")

#Cumulative cases
ggplot(data = covid) +
  geom_point(mapping = aes(x = date, y = cumulative_cases)) +
  labs(title = "Figure 2c. Cumulative cases from 2020-12-14 to 2021-10-05") +
  labs(x = "Date", y = "Cumulative cases")

#Cumulative deaths
ggplot(data = covid) +
  geom_point(mapping = aes(x = date, y = cumulative_deaths)) +
  labs(title = "Figure 2e. Cumulative deaths from 2020-12-14 to 2021-10-05") +
  labs(x = "Date", y = "Cumulative deaths")
```


```{r data visualization}
#Vaccination rates and cases
covid[covid$dose1 > 0,] %>%
ggplot() +
  geom_point(mapping = aes(x = dose1, y = cases, color = "First dose")) +
  geom_smooth(mapping = aes(x = dose1, y = cases)) +
  geom_point(mapping = aes(x = dose2, y = cases, color = "Second dose")) +
  geom_smooth(mapping = aes(x = dose2, y = cases)) +
  labs(title = "Figure 3a. Vaccination rates and cases") +
  labs(x = "Vaccination rates", y = "Daily new cases")

#Vaccination rates and deaths
covid[covid$dose1 > 0,] %>%
ggplot() +
  geom_point(mapping = aes(x = dose1, y = deaths, color = "First dose")) +
  geom_smooth(mapping = aes(x = dose1, y = deaths)) +
  geom_point(mapping = aes(x = dose2, y = deaths, color = "Second dose")) +
  geom_smooth(mapping = aes(x = dose2, y = deaths)) +
  labs(title = "Figure 3b. Vaccination rates and deaths") +
  labs(x = "Vaccination rates", y = "Daily new deaths")
```


```{r}

```


```{r}

```

#Conclusion





